# Vid2Img Cropper

Vid2Img Cropper 是一个 Python 桌面应用程序，用于自动检测视频文件中的人物脸部，将包含脸部的画面区域裁剪出来，并保存这些裁剪后的图片。同时，记录每次裁剪对应的原始视频时间点，以便用户可以从裁剪结果快速跳转回视频的相应位置。

## 核心功能

- **视频处理**: 加载用户选择的视频文件。
- **人脸检测**: 逐帧（或按指定间隔抽帧）分析视频，检测画面中的人脸。
- **图像裁剪**: 根据检测到的脸部边界框 (Bounding Box)，从原始高分辨率帧中裁剪出包含脸部的区域。
- **数据存储**: 将裁剪出的图片保存为独立文件，并将相关的元数据（如原始视频路径、时间戳、裁剪图片路径等）存储起来。
- **结果浏览与跳转**: 在 GUI 中展示裁剪出的图片（例如缩略图列表），并允许用户通过点击某个裁剪结果，快速在视频播放器中定位到该画面在原始视频中的精确时间点。

## 技术栈

- **编程语言**: Python 3
- **GUI 框架**: PySide6 (Qt for Python)
- **核心处理库**:
  - OpenCV (opencv-python): 用于视频读取、帧处理、图像缩放、人脸检测和图像裁剪。
  - NumPy: OpenCV 的依赖，用于数值计算。
  - YuNet 模型: 用于人脸检测，速度和精度均衡。
  - (备选) lbpcascade_animeface: 用于动漫人脸检测。
- **数据存储**: SQLite3，用于存储裁剪元数据。
- **感知哈希库**: ImageHash，用于实现重复/静态帧检测优化。

## 安装

### 依赖项

```bash
# 使用 pip 安装依赖
pip install -r requirements.txt

# 或使用 uv 安装依赖
uv pip install -r requirements.txt
```

### 运行

```bash
python main.py
```

## 使用方法

1. 启动应用程序。
2. 在"处理"选项卡中，点击"浏览"按钮选择要处理的视频文件。
3. 调整处理选项（如检测宽度、每秒处理帧数、置信度阈值等）。
4. 点击"开始处理"按钮开始处理视频。
5. 处理完成后，切换到"结果"选项卡查看裁剪结果。
6. 点击缩略图可以查看详细信息，并可以跳转到视频的相应位置。

## 配置选项

- **检测宽度**: 用于检测的目标分辨率宽度。
- **每秒处理帧数**: 控制处理的帧率。
- **置信度阈值**: 人脸检测的置信度阈值。
- **跳过相似帧**: 是否跳过相似的帧。
- **相似度阈值**: 判断帧相似的阈值。
- **裁剪边距**: 裁剪时额外添加的边距。
- **裁剪宽高比**: 裁剪结果的宽高比。
- **输出格式**: 保存图像的格式（JPG、PNG、WebP）。
- **输出质量**: 保存图像的质量。

## 许可证

[MIT License](LICENSE)
